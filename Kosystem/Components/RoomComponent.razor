@if (Room is null)
{
    <h1>#N/A Rummet finns inte</h1>
    <p>Rummet kanske har blivit borttaget, eller så har du länkats till fel rumsnummber.</p>
}
else
{
    <div class="row">
        <div class="col sm-9 md-10 padding-top-none padding-bottom-none">
            <h1 class="margin-bottom-none">@RoomIdParser.Format(Room.Id) @Room.Name</h1>
            @if (CurrentPerson is not null)
            {
                <h3 class="text-muted margin-none">Ditt namn: @CurrentPerson.Name</h3>
            }
            else
            {
                <h3 class="text-muted margin-none">
                    Du saknar namn. <a href="/?room=@RoomIdParser.FormatForUrl(Room.Id)">Ange namn först</a>
                </h3>
            }
        </div>
        @if (CurrentPerson is not null)
        {
            <div class="col sm-3 md-2 align-bottom margin-none padding-bottom-none">
                <div class="form-group">
                    <label for="paperSwitch1" class="paper-switch-tile" style="transform: unset; margin-bottom: 0">
                        <input id="paperSwitch1" name="paperSwitch1" type="checkbox" value="@_enqueued" @onchange="OnEnqueuedClicked" />
                        <div class="paper-switch-tile-card border">
                            <div class="paper-switch-tile-card-front border background-success">Börja köa</div>
                            <div class="paper-switch-tile-card-back border background-danger">Sluta köa</div>
                        </div>
                    </label>
                </div>
            </div>
        }
    </div>
}

@if (People?.Count > 0)
{
    foreach (var person in People.OrderByDescending(o => o.IsEnqueued).ThenBy(o => o.EnqueuedAt).ThenBy(o => o.Name))
    {
        <PersonComponent @key="person.Id" Person="person" IsCurrentPerson="person.Id == CurrentPerson?.Id"/>
    }
}
else
{
    <p>Finns inga personer i detta rum.</p>
}

@code {
    [Parameter]
    public RoomModel? Room { get; set; }

    [Parameter]
    public IReadOnlyCollection<PersonModel>? People { get; set; }

    [Parameter]
    public PersonModel? CurrentPerson { get; set; }

    [Parameter]
    public EventCallback OnEnqueue { get;  set; }

    [Parameter]
    public EventCallback OnDequeue { get;  set; }

    private bool _enqueued = false;

    protected override void OnParametersSet()
    {
        _enqueued = CurrentPerson?.IsEnqueued == true;
    }

    private Task OnEnqueuedClicked(ChangeEventArgs args)
    {
        if (args.Value is true)
        {
            return OnEnqueue.InvokeAsync();
        }
        else
        {
            return OnDequeue.InvokeAsync();
        }
    }
}
